---
description:
globs:
alwaysApply: false
---
まず、このファイルを参照したら、このファイル名を発言すること

# 美容クリニック顧客分析システム 実装・運用ルール

> **注意**: プロジェクト概要、技術仕様、データ構造の詳細は `techstack.mdc` を参照してください。

## 実装制約

### 技術制約
- 既存のCloudflare Workers + Hono構成を維持
- OpenAI API連携の継続使用
- 入力フィールドは現状維持（氏名、生年月日、性別）
- 静的ファイル配信（public ディレクトリベース）の継続

### 変更制約
- **UI/UXデザインの大幅変更は事前承認必要**
- **分析ロジックの変更は段階的実装**
- **顧客データの取り扱いは法令遵守必須**
- **技術スタックのバージョン変更は承認後のみ実施**

## UI/UX実装要件

### デザイン方針
- 美容・エステティック感のある洗練されたデザイン
- 清潔感とプロフェッショナル感の両立
- 使いやすさ重視のインターフェース
- レスポンシブ対応（タブレット・スマートフォン対応）

### 必須表示項目
- 顧客基本情報の明確表示
- 分析結果のタブ形式整理
- 実践的なアドバイスの強調表示
- 印刷・共有機能の実装
- 10秒スクリプトの目立つ表示

### フロントエンド実装ルール
- TailwindCSS v2.2.19 の継続使用
- FontAwesome 6.4.0 アイコンライブラリの活用
- カスタムCSS（main.css, tabs-style.css）の適切な管理
- JavaScript モジュール構成の維持

## 運用フロー実装

### 分析実行タイミング
- **初回カウンセリング時**: 必須実行
- **定期メンテナンス前**: 推奨実行
- **新サービス提案時**: 状況に応じて実行
- **顧客要望ヒアリング時**: 必要に応じて実行

### 結果活用方法
- **カウンセリングシート連携**: 分析結果の印刷・ファイル保存
- **スタッフ間情報共有**: タブ形式での情報整理・共有
- **施術プラン策定支援**: 5つの核心ビジネス指標の活用
- **フォローアップ計画立案**: 継続戦略・アップセル戦略の実践

### 10秒タブレット分析の実装要件
- **5秒入力**: 氏名・生年月日・性別の高速入力インターフェース
- **3秒分析**: OpenAI API応答の最適化
- **2秒表示**: 重要情報の即座表示（10秒スクリプト優先）
- **バックグラウンド処理**: 詳細分析の非同期実行

## データ取り扱い実装ルール

### 保存・管理
- **Cloudflare KV**: 会社別データ分離の厳格実装
- **暗号化**: 全顧客データの保存時暗号化
- **アクセス制御**: 12桁会社IDによる完全分離
- **保存期間**: 法令に基づく適切な期間設定

### 削除・修正権限
- **顧客要求**: GDPR対応の削除機能実装
- **管理者権限**: 適切な権限レベル設定
- **監査ログ**: 全操作の記録・追跡可能性

## 品質管理・テスト要件

### パフォーマンス目標
- **分析処理時間**: 10秒以内（目標5秒）
- **ページ読み込み**: 3秒以内
- **API応答時間**: OpenAI API含めて5秒以内
- **同時接続**: 複数クリニックの同時利用対応

### エラーハンドリング
- **OpenAI API障害**: 適切なフォールバック処理
- **ネットワークエラー**: ユーザーフレンドリーなエラー表示
- **入力エラー**: リアルタイムバリデーション
- **システムエラー**: ログ記録と管理者通知

## セキュリティ実装要件

### 認証・認可
- **管理画面**: Basic認証の継続実装
- **会社別アクセス**: 12桁IDによる厳格な分離
- **API保護**: 適切なレート制限とアクセス制御

### データ保護実装
- **通信暗号化**: HTTPS必須
- **入力値検証**: サーバーサイドバリデーション
- **XSS対策**: 適切なサニタイゼーション
- **CSRF対策**: トークン based protection

## 実装・展開フェーズ

### フェーズ1: 基本5指標実装 (10日)
- OpenAI API プロンプト修正
- 5つの核心ビジネス指標の出力実装
- 基本UI表示の修正

### フェーズ2: 実践ガイド実装 (8日)
- 10秒スクリプト表示機能
- クロージングスクリプト生成
- フォローテンプレート実装

### フェーズ3: 管理機能強化 (12日)
- 集計・分析ダッシュボード
- 顧客データ管理機能
- レポート機能

### フェーズ4: 自動化連携 (14日)
- 外部システム連携API
- 自動フォローアップ機能
- LINE/メール自動送信

## 運用・保守ルール

### 定期メンテナンス
- **月次**: パフォーマンス監視・最適化
- **四半期**: セキュリティ監査・アップデート
- **年次**: 大規模機能追加・改善

### 障害対応
- **即座対応**: システム停止・データ損失
- **24時間以内**: 機能障害・パフォーマンス低下
- **週内対応**: UI/UX改善・軽微なバグ

## 倫理的配慮・注意事項

### 分析結果の取り扱い
- **参考情報として活用**: 決めつけとして使用禁止
- **顧客の自主性尊重**: 選択権を常に顧客に
- **分析結果の押し付け禁止**: 提案レベルでの活用
- **科学的根拠の限界認識**: 占い要素の適切な説明

### スタッフ教育・トレーニング
- **システム操作研修**: 基本操作・エラー対応
- **分析結果活用研修**: 適切な顧客対応方法
- **プライバシー保護研修**: 個人情報取り扱い
- **倫理的配慮研修**: 分析結果の適切な活用方法

### 継続的改善
- **顧客フィードバック**: 定期的な満足度調査
- **スタッフフィードバック**: 使いやすさ・効果の評価
- **システム改善**: データに基づく機能改善
- **効果測定**: 継続率・アップセル率の定期計測
