---
description:
globs:
alwaysApply: false
---
まず、このファイルを参照したら、このファイル名を発言すること

# 美容クリニック顧客分析システム - タスク管理

## プロジェクト概要
5つの核心ビジネス指標（継続志向度・新規刺激欲求・価格価値観感度・決断スピード・コミュニケーションスタイル）を実装し、美容クリニックの継続率・アップセル率向上を実現する。

## 実装フェーズ

### フェーズ1: 基本5指標分析機能（優先度：最高）
**目標**: 占い分析から5つのビジネス指標を出力する基本機能の実装

#### バックエンド実装

##### 📋 Task 1.1: OpenAI APIプロンプト修正
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 既存のsystemPromptを5つの指標対応に拡張
- [ ] **詳細**:
  - [ ] memo-5.mdのプロンプトをベースに美容クリニック特化版に改修
  - [ ] 5つの指標（継続志向度、新規刺激欲求、価格価値観感度、決断スピード、コミュニケーションスタイル）の明確な出力指示
  - [ ] 各指標の1-10スコア、タイプ分類、具体的推奨事項の出力
- [ ] **成果物**:
  - [ ] 修正されたsystemPrompt
  - [ ] テスト用サンプル入力・期待出力
- [ ] **注意事項**: 既存のAPI構造を壊さないよう、拡張形式で実装

##### 📋 Task 1.2: レスポンス解析機能強化
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 2日
- [ ] **概要**: OpenAI APIレスポンスから5指標を抽出・構造化
- [ ] **詳細**:
  - [ ] businessMetrics セクションの解析機能追加
  - [ ] practicalGuide セクションの解析機能追加
  - [ ] エラーハンドリング強化（指標解析失敗時の代替処理）
- [ ] **成果物**:
  - [ ] 拡張されたレスポンス解析ロジック
  - [ ] 構造化データのバリデーション機能

#### フロントエンド実装

##### 📋 Task 1.3: result-tabs.html の指標表示セクション追加
- [ ] **担当**: フロントエンド開発者
- [ ] **期限**: 4日
- [ ] **概要**: 5つの指標を視覚的に表示する新セクション
- [ ] **詳細**:
  - [ ] 顧客特性タブに「5つの核心指標」セクション追加
  - [ ] 各指標の1-10スコアをプログレスバーで表示
  - [ ] タイプ分類（ルーティン型/変化型等）をバッジ表示
  - [ ] 推奨事項を分かりやすくカード形式で表示
- [ ] **成果物**:
  - [ ] 修正されたresult-tabs.html
  - [ ] 指標表示用CSS追加

##### 📋 Task 1.4: JavaScript制御機能追加
- [ ] **担当**: フロントエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 5指標データの取得・表示制御
- [ ] **詳細**:
  - [ ] tabs-overview.js に指標表示ロジック追加
  - [ ] businessMetrics データの解析・表示
  - [ ] エラー時の代替表示機能
- [ ] **成果物**:
  - [ ] 修正されたtabs-overview.js
  - [ ] 指標表示の動作テスト完了

### フェーズ2: 実践ガイド機能（優先度：高）
**目標**: 10秒スクリプト、クロージング、フォローテンプレート等の実践的ガイド表示

##### 📋 Task 2.1: 実践ガイドタブ新設
- [ ] **担当**: フロントエンド開発者
- [ ] **期限**: 5日
- [ ] **概要**: 実践的活用ガイド専用タブの追加
- [ ] **詳細**:
  - [ ] result-tabs.html に6番目のタブとして「実践ガイド」追加
  - [ ] 来店時10秒スクリプト表示セクション
  - [ ] 予約クロージングスクリプト表示セクション
  - [ ] フォローDM/LINEテンプレート表示セクション
  - [ ] スタッフ向け会話メモ表示セクション
- [ ] **成果物**:
  - [ ] 実践ガイドタブ実装
  - [ ] tabs-practical.js 新規作成

##### 📋 Task 2.2: プロンプト拡張（実践ガイド対応）
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 実践的なスクリプト・テンプレート生成指示を追加
- [ ] **詳細**:
  - [ ] 10秒スクリプト生成指示
  - [ ] タイプ別クロージング話法生成
  - [ ] 指標別フォローメッセージテンプレート生成
- [ ] **成果物**:
  - [ ] 拡張されたsystemPrompt
  - [ ] 実践ガイド出力のテスト

### フェーズ3: 管理機能・分析機能（優先度：中）
**目標**: 指標別効果測定・管理機能の実装

##### 📋 Task 3.1: 簡易ダッシュボード機能
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 7日
- [ ] **概要**: admin画面に分析結果サマリー表示
- [ ] **詳細**:
  - [ ] /admin/analytics ページ新設
  - [ ] 指標別集計データ表示
  - [ ] 会社別・期間別の傾向分析
- [ ] **成果物**:
  - [ ] analytics.route.js 新規作成
  - [ ] 分析画面HTML実装

##### 📋 Task 3.2: データ蓄積・集計機能
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 5日
- [ ] **概要**: 分析結果のKV保存・集計機能
- [ ] **詳細**:
  - [ ] 5指標データの構造化保存
  - [ ] 会社別・顧客別集計機能
  - [ ] 期間別トレンド分析データ生成
- [ ] **成果物**:
  - [ ] データ蓄積ロジック実装
  - [ ] 集計API実装

### フェーズ4: 自動化・拡張機能（優先度：低）
**目標**: 将来的な自動化・AI連携機能の基盤

##### 📋 Task 4.1: テンプレート自動生成API
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 10日
- [ ] **概要**: 指標に基づくメッセージテンプレート自動生成
- [ ] **詳細**:
  - [ ] /api/template エンドポイント新設
  - [ ] 指標パラメータ受信→カスタムテンプレート生成
  - [ ] LINEメッセージ形式、メール形式対応
- [ ] **成果物**:
  - [ ] テンプレート生成API
  - [ ] 各種フォーマット対応

##### 📋 Task 4.2: Webhook連携基盤
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 14日
- [ ] **概要**: 外部システム（LINE、メール等）との連携基盤
- [ ] **詳細**:
  - [ ] webhook受信機能
  - [ ] 外部API呼び出し機能
  - [ ] 自動フォロー機能の基盤実装
- [ ] **成果物**:
  - [ ] 連携基盤実装
  - [ ] サンプル連携デモ

### フェーズ5: UI大幅改修・管理機能強化（優先度：高）
**目標**: UIの大幅リニューアル、CSV一括ダウンロード、コミュニケーション実行管理機能の実装

#### データ管理機能

##### 📋 Task 5.1: KVストレージ構造最適化
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 新機能に対応したKVストレージ構造の設計・実装
- [ ] **詳細**:
  - [ ] costomer-assessment-company: 会社登録情報の構造化
  - [ ] costomer-assessment-analytics: 個人分析情報の構造化
  - [ ] コミュニケーション実行状況の管理データ構造追加
  - [ ] 対応履歴データの管理構造追加
- [ ] **成果物**:
  - [ ] KVストレージスキーマ設計書
  - [ ] データマイグレーション機能

##### 📋 Task 5.2: CSV一括ダウンロード機能
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 5日
- [ ] **概要**: 分析結果・顧客情報のCSV一括出力機能
- [ ] **詳細**:
  - [ ] /api/csv/analytics エンドポイント新設
  - [ ] 会社別・期間別フィルタリング機能
  - [ ] 5つの核心指標、基本情報、実践ガイドの全項目出力
  - [ ] Excel互換形式（UTF-8 BOM付き）対応
  - [ ] 管理画面からのダウンロードボタン実装
- [ ] **成果物**:
  - [ ] CSV出力API実装
  - [ ] 管理画面UI実装
  - [ ] ダウンロード機能テスト完了

#### コミュニケーション管理機能

##### 📋 Task 5.3: コミュニケーション実行チェック機能
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 7日
- [ ] **概要**: 「今回どんなコミュニケーションを取るか」の実行チェック機能
- [ ] **詳細**:
  - [ ] 分析結果表示に「今回のコミュニケーション計画」セクション追加
  - [ ] 実践ガイドから「今回実行する項目」をチェックリスト化
  - [ ] 各項目の実行状況をチェックボックスで管理
  - [ ] 実行日時・担当者の記録機能
  - [ ] 実行状況の保存・読み込み機能
- [ ] **成果物**:
  - [ ] コミュニケーション管理UI実装
  - [ ] 実行状況保存API実装
  - [ ] チェック状況の可視化機能

##### 📋 Task 5.4: 対応履歴管理機能
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 8日
- [ ] **概要**: 顧客とのコミュニケーション履歴を記録・管理する機能
- [ ] **詳細**:
  - [ ] 対応履歴入力フォームの実装
  - [ ] 対応内容（電話・メール・LINE・来店等）の分類機能
  - [ ] 対応結果・次回アクション項目の記録
  - [ ] 履歴の時系列表示機能
  - [ ] 履歴検索・フィルタリング機能
  - [ ] 対応効果測定（継続率・アップセル率）との連携
- [ ] **成果物**:
  - [ ] 対応履歴管理画面実装
  - [ ] 履歴データ管理API実装
  - [ ] 効果測定レポート機能

#### UI大幅リニューアル

##### 📋 Task 5.5: 分析結果画面の全面刷新
- [ ] **担当**: フロントエンド開発者・UI/UXデザイナー
- [ ] **期限**: 10日
- [ ] **概要**: より使いやすく視覚的な分析結果画面への全面改修
- [ ] **詳細**:
  - [ ] カード型レイアウトの採用
  - [ ] 5つの核心指標のダッシュボード形式表示
  - [ ] 「今回のコミュニケーション計画」専用セクション
  - [ ] アクションアイテム（実行チェックリスト）の明確化
  - [ ] モバイル対応の強化
  - [ ] 印刷レイアウトの最適化
- [ ] **成果物**:
  - [ ] 新UI設計書・ワイヤーフレーム
  - [ ] 刷新されたresult-tabs.html
  - [ ] レスポンシブ対応CSS

##### 📋 Task 5.6: 管理画面の機能拡張
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 6日
- [ ] **概要**: CSV出力、実行状況確認、履歴管理を統合した管理画面
- [ ] **詳細**:
  - [ ] ダッシュボード形式の統計表示
  - [ ] 顧客別実行状況一覧
  - [ ] 対応履歴の集約表示
  - [ ] 効果測定レポート（継続率・アップセル率推移）
  - [ ] データ検索・フィルタリング機能強化
- [ ] **成果物**:
  - [ ] 拡張された管理画面実装
  - [ ] 統計・レポート機能実装

### フェーズ6: 効果測定・改善機能（優先度：中）

## 品質管理・テスト

### 📋 Task T1: APIデータ連携保護テスト
- [ ] **担当**: テスト担当者
- [ ] **期限**: 各フェーズ完了後
- [ ] **概要**: 既存機能の動作確認
- [ ] **詳細**:
  - [ ] 既存のform.html → API → result.html/result-tabs.html の動作確認
  - [ ] 従来のデータ構造（customerProfile等）の出力確認
  - [ ] エラーハンドリングの動作確認

### 📋 Task T2: パフォーマンステスト
- [ ] **担当**: テスト担当者
- [ ] **期限**: フェーズ1完了後
- [ ] **概要**: 10秒分析の実現可能性確認
- [ ] **詳細**:
  - [ ] OpenAI API応答時間測定
  - [ ] フロントエンド描画速度測定
  - [ ] 同時アクセス負荷テスト

## 進行管理

### マイルストーン
- [ ] **M1**: フェーズ1完了（基本5指標機能） - 10日後
- [ ] **M2**: フェーズ2完了（実践ガイド機能） - 18日後
- [ ] **M3**: フェーズ3完了（管理・分析機能） - 30日後
- [ ] **M4**: フェーズ4完了（自動化基盤） - 44日後
- [ ] **M5**: フェーズ5完了（UI大幅改修・管理機能強化） - 54日後
- [ ] **M6**: フェーズ6完了（効果測定・改善機能） - 64日後

### 定期確認
- **週次レビュー**: 毎週金曜日 16:00-17:00
- **デイリースタンドアップ**: 平日 9:30-9:45
- **課題エスカレーション**: 遅延リスク2日前に報告

## リスク管理

### 高リスク項目
1. **OpenAI APIレスポンス品質**: プロンプト調整が想定より困難な場合
   - **対策**: 段階的プロンプト改善、手動調整機能の追加
2. **データ構造互換性**: 既存機能への影響
   - **対策**: 拡張形式での実装、後方互換性テスト強化
3. **10秒分析目標**: API応答時間の不安定性
   - **対策**: キャッシュ機能追加、段階的表示の検討

### 成功基準
- **機能面**: 5指標の正確な分析・表示
- **性能面**: 分析開始から結果表示まで15秒以内
- **ビジネス面**: 美容クリニックでの実用性確認
- **管理面**: CSV一括ダウンロード・コミュニケーション実行管理の実用性確認
- **UI/UX面**: モバイル対応・印刷対応・直感的操作性の確保
- **データ管理面**: 対応履歴の蓄積・効果測定との連携確認

### 新機能の期待効果
- **CSV一括ダウンロード**: クリニック側の顧客管理効率化（作業時間50%削減目標）
- **コミュニケーション実行チェック**: スタッフの対応漏れ防止（実行率80%以上目標）
- **対応履歴管理**: 顧客満足度向上・継続率改善（+5%目標）
- **UI刷新**: 操作習得時間短縮（新人スタッフ30分以内で操作習得目標）

## 注意事項
- **データ連携保護**: 既存のAPI構造・出力部分は一切変更禁止
- **段階的実装**: 各フェーズでの動作確認を必須とする

## 進捗管理の使い方

### チェックボックスの使用方法
- `[ ]` : 未完了タスク
- `[x]` : 完了タスク

### 更新タイミング
- **毎日**: 作業完了時にチェックボックスを更新
- **週次レビュー**: 全体進捗の確認・調整
- **フェーズ完了時**: マイルストーンにチェック

### 進捗レポート例
```
## 今週の進捗 (例: 2024/1/15-1/19)
- Task 1.1: OpenAI APIプロンプト修正 ✅ 完了
- Task 1.2: レスポンス解析機能強化 🔄 進行中(80%)
- Task 1.3: result-tabs.html修正 ⏳ 未着手
```
