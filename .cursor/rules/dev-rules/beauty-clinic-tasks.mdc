---
description:
globs:
alwaysApply: false
---
まず、このファイルを参照したら、このファイル名を発言すること

# 美容クリニック顧客分析システム - タスク管理

## プロジェクト概要
5つの核心ビジネス指標（継続志向度・新規刺激欲求・価格価値観感度・決断スピード・コミュニケーションスタイル）を実装し、美容クリニックの継続率・アップセル率向上を実現する。

## 実装フェーズ

### フェーズ1: 基本5指標分析機能（優先度：最高）
**目標**: 占い分析から5つのビジネス指標を出力する基本機能の実装

#### バックエンド実装

##### 📋 Task 1.1: OpenAI APIプロンプト修正
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 既存のsystemPromptを5つの指標対応に拡張
- [ ] **詳細**:
  - [ ] memo-5.mdのプロンプトをベースに美容クリニック特化版に改修
  - [ ] 5つの指標（継続志向度、新規刺激欲求、価格価値観感度、決断スピード、コミュニケーションスタイル）の明確な出力指示
  - [ ] 各指標の1-10スコア、タイプ分類、具体的推奨事項の出力
- [ ] **成果物**:
  - [ ] 修正されたsystemPrompt
  - [ ] テスト用サンプル入力・期待出力
- [ ] **注意事項**: 既存のAPI構造を壊さないよう、拡張形式で実装

##### 📋 Task 1.2: レスポンス解析機能強化
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 2日
- [ ] **概要**: OpenAI APIレスポンスから5指標を抽出・構造化
- [ ] **詳細**:
  - [ ] businessMetrics セクションの解析機能追加
  - [ ] practicalGuide セクションの解析機能追加
  - [ ] エラーハンドリング強化（指標解析失敗時の代替処理）
- [ ] **成果物**:
  - [ ] 拡張されたレスポンス解析ロジック
  - [ ] 構造化データのバリデーション機能

#### フロントエンド実装

##### 📋 Task 1.3: result-tabs.html の指標表示セクション追加
- [ ] **担当**: フロントエンド開発者
- [ ] **期限**: 4日
- [ ] **概要**: 5つの指標を視覚的に表示する新セクション
- [ ] **詳細**:
  - [ ] 顧客特性タブに「5つの核心指標」セクション追加
  - [ ] 各指標の1-10スコアをプログレスバーで表示
  - [ ] タイプ分類（ルーティン型/変化型等）をバッジ表示
  - [ ] 推奨事項を分かりやすくカード形式で表示
- [ ] **成果物**:
  - [ ] 修正されたresult-tabs.html
  - [ ] 指標表示用CSS追加

##### 📋 Task 1.4: JavaScript制御機能追加
- [ ] **担当**: フロントエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 5指標データの取得・表示制御
- [ ] **詳細**:
  - [ ] tabs-overview.js に指標表示ロジック追加
  - [ ] businessMetrics データの解析・表示
  - [ ] エラー時の代替表示機能
- [ ] **成果物**:
  - [ ] 修正されたtabs-overview.js
  - [ ] 指標表示の動作テスト完了

### フェーズ2: 実践ガイド機能（優先度：高）
**目標**: 10秒スクリプト、クロージング、フォローテンプレート等の実践的ガイド表示

##### 📋 Task 2.1: 実践ガイドタブ新設
- [ ] **担当**: フロントエンド開発者
- [ ] **期限**: 5日
- [ ] **概要**: 実践的活用ガイド専用タブの追加
- [ ] **詳細**:
  - [ ] result-tabs.html に6番目のタブとして「実践ガイド」追加
  - [ ] 来店時10秒スクリプト表示セクション
  - [ ] 予約クロージングスクリプト表示セクション
  - [ ] フォローDM/LINEテンプレート表示セクション
  - [ ] スタッフ向け会話メモ表示セクション
- [ ] **成果物**:
  - [ ] 実践ガイドタブ実装
  - [ ] tabs-practical.js 新規作成

##### 📋 Task 2.2: プロンプト拡張（実践ガイド対応）
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 3日
- [ ] **概要**: 実践的なスクリプト・テンプレート生成指示を追加
- [ ] **詳細**:
  - [ ] 10秒スクリプト生成指示
  - [ ] タイプ別クロージング話法生成
  - [ ] 指標別フォローメッセージテンプレート生成
- [ ] **成果物**:
  - [ ] 拡張されたsystemPrompt
  - [ ] 実践ガイド出力のテスト

### フェーズ3: 管理機能・分析機能（優先度：中）
**目標**: 指標別効果測定・管理機能の実装

##### 📋 Task 3.1: 簡易ダッシュボード機能
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 7日
- [ ] **概要**: admin画面に分析結果サマリー表示
- [ ] **詳細**:
  - [ ] /admin/analytics ページ新設
  - [ ] 指標別集計データ表示
  - [ ] 会社別・期間別の傾向分析
- [ ] **成果物**:
  - [ ] analytics.route.js 新規作成
  - [ ] 分析画面HTML実装

##### 📋 Task 3.2: データ蓄積・集計機能
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 5日
- [ ] **概要**: 分析結果のKV保存・集計機能
- [ ] **詳細**:
  - [ ] 5指標データの構造化保存
  - [ ] 会社別・顧客別集計機能
  - [ ] 期間別トレンド分析データ生成
- [ ] **成果物**:
  - [ ] データ蓄積ロジック実装
  - [ ] 集計API実装

### フェーズ4: 自動化・拡張機能（優先度：低）
**目標**: 将来的な自動化・AI連携機能の基盤

##### 📋 Task 4.1: テンプレート自動生成API
- [ ] **担当**: バックエンド開発者
- [ ] **期限**: 10日
- [ ] **概要**: 指標に基づくメッセージテンプレート自動生成
- [ ] **詳細**:
  - [ ] /api/template エンドポイント新設
  - [ ] 指標パラメータ受信→カスタムテンプレート生成
  - [ ] LINEメッセージ形式、メール形式対応
- [ ] **成果物**:
  - [ ] テンプレート生成API
  - [ ] 各種フォーマット対応

##### 📋 Task 4.2: Webhook連携基盤
- [ ] **担当**: フルスタック開発者
- [ ] **期限**: 14日
- [ ] **概要**: 外部システム（LINE、メール等）との連携基盤
- [ ] **詳細**:
  - [ ] webhook受信機能
  - [ ] 外部API呼び出し機能
  - [ ] 自動フォロー機能の基盤実装
- [ ] **成果物**:
  - [ ] 連携基盤実装
  - [ ] サンプル連携デモ

## 品質管理・テスト

### 📋 Task T1: APIデータ連携保護テスト
- [ ] **担当**: テスト担当者
- [ ] **期限**: 各フェーズ完了後
- [ ] **概要**: 既存機能の動作確認
- [ ] **詳細**:
  - [ ] 既存のform.html → API → result.html/result-tabs.html の動作確認
  - [ ] 従来のデータ構造（customerProfile等）の出力確認
  - [ ] エラーハンドリングの動作確認

### 📋 Task T2: パフォーマンステスト
- [ ] **担当**: テスト担当者
- [ ] **期限**: フェーズ1完了後
- [ ] **概要**: 10秒分析の実現可能性確認
- [ ] **詳細**:
  - [ ] OpenAI API応答時間測定
  - [ ] フロントエンド描画速度測定
  - [ ] 同時アクセス負荷テスト

## 進行管理

### マイルストーン
- [ ] **M1**: フェーズ1完了（基本5指標機能） - 10日後
- [ ] **M2**: フェーズ2完了（実践ガイド機能） - 18日後
- [ ] **M3**: フェーズ3完了（管理・分析機能） - 30日後
- [ ] **M4**: フェーズ4完了（自動化基盤） - 44日後

### 定期確認
- **週次レビュー**: 毎週金曜日 16:00-17:00
- **デイリースタンドアップ**: 平日 9:30-9:45
- **課題エスカレーション**: 遅延リスク2日前に報告

## リスク管理

### 高リスク項目
1. **OpenAI APIレスポンス品質**: プロンプト調整が想定より困難な場合
   - **対策**: 段階的プロンプト改善、手動調整機能の追加
2. **データ構造互換性**: 既存機能への影響
   - **対策**: 拡張形式での実装、後方互換性テスト強化
3. **10秒分析目標**: API応答時間の不安定性
   - **対策**: キャッシュ機能追加、段階的表示の検討

### 成功基準
- **機能面**: 5指標の正確な分析・表示
- **性能面**: 分析開始から結果表示まで15秒以内
- **ビジネス面**: 美容クリニックでの実用性確認

## 注意事項
- **データ連携保護**: 既存のAPI構造・出力部分は一切変更禁止
- **段階的実装**: 各フェーズでの動作確認を必須とする

## 進捗管理の使い方

### チェックボックスの使用方法
- `[ ]` : 未完了タスク
- `[x]` : 完了タスク

### 更新タイミング
- **毎日**: 作業完了時にチェックボックスを更新
- **週次レビュー**: 全体進捗の確認・調整
- **フェーズ完了時**: マイルストーンにチェック

### 進捗レポート例
```
## 今週の進捗 (例: 2024/1/15-1/19)
- Task 1.1: OpenAI APIプロンプト修正 ✅ 完了
- Task 1.2: レスポンス解析機能強化 🔄 進行中(80%)
- Task 1.3: result-tabs.html修正 ⏳ 未着手
```
